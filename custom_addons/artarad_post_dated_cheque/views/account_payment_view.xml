<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_form_artarad_account_payment_register_inherit" model="ir.ui.view">
        <field name="name">view.form.artarad.account.payment.register.inherit</field>
        <field name="model">account.payment.register</field>
        <field name="inherit_id" ref="account.view_account_payment_register_form" />
        <field name="arch" type="xml">
            <xpath expr="/form" position="inside">
                <field name="payment_method_code" invisible="1" />
                <field name="cheque_outbound_mode" invisible="1" force_save="1" />
            </xpath>

            <xpath expr="//field[@name='amount']" position="attributes">
                <attribute name="readonly">cheque_outbound_mode == 'spend'</attribute>
                <attribute name="force_save">1</attribute>
            </xpath>

            <xpath expr="//field[@name='journal_id']" position="replace">
                <field name="journal_id" widget="selection"
                    domain="[('type', 'in', ('bank', 'cash', 'post_dated_cheque'))]" />
            </xpath>

            <xpath expr="/form/group" position="after">
                <group string="Cheque Fields" invisible="payment_method_code != 'cheque'" />

                <group invisible="payment_method_code != 'cheque' or payment_type not in ('outbound', 'transfer') or cheque_outbound_mode != 'spend'">
                    <field name="spending_cheques"
                        required="payment_method_code == 'cheque' or payment_type in ('outbound', 'transfer') or cheque_outbound_mode == 'spend'"
                        widget='many2many' options="{'no_create': True}"
                        domain="[('payment_method_code', '=', 'cheque'), ('payment_type', 'in', ['inbound', 'transfer']), ('state', 'in', ('paid','in_process')), ('cheque_state.is_spendable', '=', True), ('spent_for', 'in', [False])]">
                        <list>
                            <field name="cheque_number" />
                            <field name="cheque_number_description" />
                            <field name="cheque_sayadi_number" />
                            <field name="cheque_bank_id" />
                            <field name="amount" />
                            <field name="partner_id" />
                            <field name="cheque_date" />
                            <field name="cheque_state" />
                        </list>
                    </field>
                </group>

                <group invisible="payment_method_code != 'cheque' or payment_type not in ('outbound', 'transfer') or cheque_outbound_mode != 'draw'">
                    <field name="available_cheque_book_ids" invisible="1" />
                    <field name="available_cheque_sheet_ids" invisible="1" />
                    <group>
                        <field name="cheque_state" readonly="1" force_save="1"
                            invisible="payment_method_code != 'cheque'" />
                        <field name="cheque_book"
                            required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'draw'"
                            domain="[('id', 'in', available_cheque_book_ids)]" />
                        <field name="cheque_sayadi_number" />
                    </group>
                    <group>
                        <field name="cheque_date"
                            required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'draw'" />
                        <field name="cheque_sheet"
                            required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'draw'"
                            domain="[('id', 'in', available_cheque_sheet_ids)]" />
                    </group>
                </group>

                <group invisible="payment_method_code != 'cheque' or payment_type not in ('inbound', 'transfer')">
                    <group>
                        <field name="cheque_state" readonly="1" force_save="1"
                            required="payment_method_code == 'cheque' and payment_type in ('inbound', 'transfer')" />
                        <field name="cheque_number"
                            required="payment_method_code == 'cheque' and payment_type in ('inbound', 'transfer')" />
                        <field name="cheque_sayadi_number" />
                    </group>
                    <group>
                        <field name="cheque_date"
                            required="payment_method_code == 'cheque' and payment_type in ('inbound', 'transfer')" />
                        <field name="cheque_number_description" />
                        <field name="cheque_bank_id" />
                    </group>
                </group>
            </xpath>

        </field>
    </record>

    <record id="action_artarad_pdc_st_chg_trans" model="ir.actions.act_window">
        <field name="name">PDC State Change Transactions</field>
        <field name="res_model">artarad.pdc.st.chg.trans</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('active', 'in', [True, False]), ('payment','=', context.get('active_id'))]</field>
    </record>

    <record id="form_artarad_account_payment" model="ir.ui.view">
        <field name="name">form.artarad.account.payment</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form" />
        <field name="arch" type="xml">

            <xpath expr="/form" position="inside">
                <field name="payment_method_code" invisible="1" />
                <field name="cheque_outbound_mode" invisible="1" force_save="1" />
            </xpath>

            <xpath expr="//field[@name='payment_transaction_id']" position="attributes">
                <attribute name="invisible">payment_method_code == 'cheque'</attribute>
            </xpath>

            <xpath expr="//field[@name='amount']" position="attributes">
                <attribute name="readonly">state != 'draft' or cheque_outbound_mode == 'spend'</attribute>
                <attribute name="force_save">1</attribute>
            </xpath>

            <xpath expr="/form/sheet/div[@name='button_box']" position="inside">
                <button class="oe_stat_button" type="action" name="%(action_artarad_pdc_st_chg_trans)d"
                    icon="fa-pencil-square-o"
                    invisible="state == 'draft' or payment_method_code != 'cheque' or cheque_outbound_mode == 'spend'">
                    <field name="cheque_state_change_transactions_count" string="PDC States" widget="statinfo" />
                </button>
            </xpath>

            <xpath expr="//field[@name='journal_id']" position="replace">
                <field name="journal_id" widget="selection"
                    domain="[('type', 'in', ('bank', 'cash', 'post_dated_cheque'))]" readonly="state != 'draft'" />
            </xpath>

            <xpath expr="/form/sheet/group" position="after">
                <group string="Cheque Fields" invisible="payment_method_code != 'cheque'" />

                <group invisible="payment_method_code != 'cheque' or payment_type not in ('outbound', 'transfer') or cheque_outbound_mode != 'spend'">
                    <field name="spending_cheques"
                        required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'spend'"
                        readonly="state == 'posted'" widget='many2many' options="{'no_create': True}"
                        domain="[('payment_method_code', '=', 'cheque'), ('payment_type', 'in', ['inbound', 'transfer']), ('state', 'in', ('paid','in_process')), ('cheque_state.is_spendable', '=', True), ('spent_for', 'in', [False])]">
                        <list>
                            <field name="cheque_number" />
                            <field name="cheque_number_description" />
                            <field name="cheque_sayadi_number" />
                            <field name="cheque_bank_id" />
                            <field name="amount" />
                            <field name="partner_id" />
                            <field name="cheque_date" />
                            <field name="cheque_state" />
                             <field name="sayadi_cheque_status"/>
                             <field name="cheque_type"/>
                        </list>
                    </field>
                </group>

                <group invisible="payment_method_code != 'cheque' or payment_type not in ('outbound', 'transfer') or cheque_outbound_mode != 'draw'">
                    <field name="available_cheque_book_ids" invisible="1" />
                    <field name="available_cheque_sheet_ids" invisible="1" />
                    <group>
                        <field name="cheque_state" readonly="1" force_save="1"
                            invisible="payment_method_code != 'cheque'" />
                        <field name="cheque_book"
                            required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'draw'"
                            readonly="state == 'posted'"
                            domain="[('id', 'in', available_cheque_book_ids)]" />
                        <field name="cheque_sayadi_number" />
                         <field name="sayadi_cheque_status" />
                         <field name="cheque_type" />
                    </group>
                    <group>
                        <field name="cheque_date"
                            required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'draw'"
                            readonly="state == 'posted'" />
                        <field name="cheque_sheet"
                            required="payment_method_code == 'cheque' and payment_type in ('outbound', 'transfer') and cheque_outbound_mode == 'draw'"
                            readonly="state == 'posted'"
                            domain="[('id', 'in', available_cheque_sheet_ids)]" />
                    </group>
                </group>

                <group invisible="payment_method_code != 'cheque' or payment_type not in ('inbound', 'transfer')">
                    <group>
                        <field name="cheque_state" readonly="1" force_save="1"
                            required="payment_method_code == 'cheque' and payment_type in ('inbound', 'transfer')" />
                        <field name="cheque_number"
                            required="payment_method_code == 'cheque' and payment_type in ('inbound', 'transfer')"
                            readonly="state == 'posted'" />
                        <field name="cheque_sayadi_number" readonly="state == 'posted'" />
                        <field name="spent_for" readonly="1" force_save="1" />
                    </group>
                    <group>
                        <field name="cheque_date"
                            required="payment_method_code == 'cheque' and payment_type in ('inbound', 'transfer')"
                            readonly="state == 'posted'" />
                        <field name="cheque_number_description" readonly="state == 'posted'" />
                        <field name="cheque_bank_id" readonly="state == 'posted'" />
                         <field name="sayadi_cheque_status" readonly="state == 'posted'"/>
                         <field name="cheque_type" readonly="state == 'posted'"/>
                    </group>
                </group>
            </xpath>

        </field>
    </record>

    <record id="search_artarad_account_payment_pdc" model="ir.ui.view">
        <field name="name">search.artarad.account.payment.pdc</field>
        <field name="model">account.payment</field>
        <field name="type">search</field>
        <field name="inherit_id" ref="account.view_account_payment_search" />
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <filter name="pdcs" string="PDCs" domain="[('payment_method_code', '=', 'cheque')]" />
                <filter name="sale_pdcs" string="Sale PDCs"
                    domain="[('payment_method_code', '=', 'cheque'),('payment_type','=', 'inbound')]" />
                <filter name="purchase_pdcs" string="Purchase PDCs"
                    domain="[('payment_method_code', '=', 'cheque'),('payment_type','=', 'outbound')]" />
            </xpath>
        </field>
    </record>

</odoo>